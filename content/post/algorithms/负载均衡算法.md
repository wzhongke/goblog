
从负载均衡的技术来看，分为服务端负载均衡和客户端负载均衡：
- 服务端负载均衡：当我们访问一个服务，请求会先到另外一台服务器，然后这台服务器会把请求分发到提供这个服务的服务器，当然如果只有一台服务器，那好说，直接把请求给那一台服务器就可以了，但是如果有多台服务器呢？这时候，就会根据一定的算法选择一台服务器。
- 客户端负载均衡：客户端服务均衡的概念貌似是有了服务治理才产生的，简单的来说，就是在一台服务器上维护着所有服务的ip，名称等信息，当我们在代码中访问一个服务，是通过一个组件访问的，这个组件会从那台服务器上取到所有提供这个服务的服务器的信息，然后通过一定的算法，选择一台服务器进行请求。

从负载均衡的算法来看，又分为 随机，轮询，哈希，最小压力，当然可能还会加上权重的概念，负载均衡的算法就是本文的重点了。

# 随机
随便从负载中获得一台，又分为完全随机和加权随机。


## 完全随机
完全随机是最简单的负载均衡算法了，缺点比较明显，因为服务器有好有坏，处理能力是不同的，我们希望性能好的服务器多处理些请求，性能差的服务器少处理一些请求，所以就有了加权随机。

## 加权随机
加权随机，虽然还是采用的随机算法，但是为每台服务器设置了权重，权重大的服务器获得的概率大一些，权重小的服务器获得的概率小一些。

关于加权随机的算法，有两种实现方式：
- 构建一个服务器的List，如果A服务器的权重是2，那么往List里面Add两次A服务器，如果B服务器的权重是7，那么我往List里面Add7次B服务器，以此类推，然后我再生成一个随机数，随机数的上限就是权重的总和，也就是List的Size。这样权重越大的，被选中的概率当然越高。缺点：如果我几台服务器权重设置的都很大，比如上千，上万，那么服务器List也有上万条数据，这不是白白占用内存
- 如果A服务器的权重是2，B服务器的权重是7，C服务器的权重是1。设置 A 的区间为[0,2]，B 的区间为 (2, 9]，C 的区间为 [10]

# 轮询
轮询又分为三种：1.完全轮询 2.加权轮询 3.平滑加权轮询

## 完全轮询
完全轮询，也是比较简单的，但是问题和完全随机是一样的，所以出现了加权轮询。

## 加权轮询
加权轮询有一点瑕疵，其中一台服务器的压力可能会突然上升，而另外的服务器却很空闲

## 平滑加权轮询
平滑加权是一个算法，很神奇的算法，我们有必要先对这个算法进行讲解。

比如A服务器的权重是5，B服务器的权重是1，C服务器的权重是1。

这个权重，我们称之为“固定权重”，既然这个叫“固定权重”，那么肯定还有叫“非固定权重的”，没错，“非固定权重”每次都会根据一定的规则变动。

1. 第一次访问，ABC的“非固定权重”分别是 5 1 1（初始），因为5是其中最大的，5对应的就是A服务器，所以这次选到的服务器就是A，然后我们用当前被选中的服务器的权重-各个服务器的权重之和，也就是A服务器的权重-各个服务器的权重之和。也就是5-7=-2，没被选中的服务器的“非固定权重”不做变化，现在三台服务器的“非固定权重”分别是-2 1 1。
2. 第二次访问，把第一次访问最后得到的“非固定权重”+“固定权重”，现在三台服务器的“非固定权重”是3，2，2，因为3是其中最大的，3对应的就是A服务器，所以这次选到的服务器就是A，然后我们用当前被选中的服务器的权重-各个服务器的权重之和，也就是A服务器的权重-各个服务器的权重之和。也就是3-7=-4，没被选中的服务器的“非固定权重”不做变化，现在三台服务器的“非固定权重”分别是-4 1 1。
3. 第三次访问，把第二次访问最后得到的“非固定权重”+“固定权重”，现在三台服务器的“非固定权重”是1，3，3，这个时候3虽然是最大的，但是却出现了两个，我们选第一个，第一个3对应的就是B服务器，所以这次选到的服务器就是B，然后我们用当前被选中的服务器的权重-各个服务器的权重之和，也就是B服务器的权重-各个服务器的权重之和。也就是3-7=-4，没被选中的服务器的“非固定权重”不做变化，现在三台服务器的“非固定权重”分别是1 -4 3。

# 哈希
负载均衡算法中的哈希算法，就是**根据某个值生成一个哈希值，然后对应到某台服务器上去，当然可以根据用户，也可以根据请求参数**，或者根据其他，想怎么来就怎么来。如果根据用户，就比较巧妙的解决了负载均衡下Session共享的问题，用户小明走的永远是A服务器，用户小笨永远走的是B服务器。

## 哈希环

## 虚拟节点
虚拟节点用来避免 哈希倾斜